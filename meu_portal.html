<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PORTAL DO ALUNO | WIGGERS ACADEMY</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cor-preto: #030303;
            --cor-fundo-card: #0c0c0c;
            --cor-ouro: #f5c542;
            --cor-texto-claro: #ffffff;
            --cor-texto-cinza: #a0a0a0;
            --borda: rgba(255, 255, 255, 0.1);
            --sucesso: #2ecc71;
            --erro: #ff4d4d;
            --azul: #3498db;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--cor-preto); color: var(--cor-texto-claro); font-family: 'Plus Jakarta Sans', sans-serif; padding-bottom: 50px; }

        .top-bar { position: sticky; top: 0; background: rgba(3, 3, 3, 0.98); padding: 15px 20px; border-bottom: 1px solid var(--cor-ouro); z-index: 100; display: flex; align-items: center; justify-content: space-between; backdrop-filter: blur(10px); }
        .btn-voltar { color: var(--cor-ouro); text-decoration: none; font-weight: 800; font-size: 0.8rem; }
        
        .container { max-width: 800px; margin: 30px auto; padding: 0 20px; }

        /* PERFIL T√âCNICO E FAIXA */
        .card-perfil { background: linear-gradient(145deg, #0f0f0f, #050505); border: 1px solid var(--borda); border-radius: 24px; padding: 30px; margin-bottom: 25px; text-align: center; }
        
        .faixa-visual { 
            width: 100%; 
            height: 45px; 
            background: #fff; /* Cor padr√£o, mudar√° via JS */
            border-radius: 6px; 
            margin: 20px 0; 
            position: relative; 
            border-bottom: 4px solid rgba(0,0,0,0.2); 
            display: flex; 
            align-items: center; 
            justify-content: flex-end; 
        }
        
        .ponteira-preta { 
            width: 100px; 
            height: 100%; 
            background: #111; 
            position: absolute; 
            right: 40px; 
            display: flex; 
            align-items: center; 
            justify-content: space-around; 
            padding: 0 8px; 
            border-left: 2px solid rgba(255,255,255,0.1);
        }
        
        .grau { width: 8px; height: 28px; background: #fff; border-radius: 1px; box-shadow: 1px 1px 2px rgba(0,0,0,0.5); }

        /* GRID DE M√âTRICAS */
        .grid-metricas { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .metrica-item { background: var(--cor-fundo-card); border: 1px solid var(--borda); padding: 20px; border-radius: 18px; }
        .metrica-item span { font-size: 0.65rem; color: var(--cor-texto-cinza); text-transform: uppercase; font-weight: 800; letter-spacing: 1px; display: block; margin-bottom: 8px; }
        .metrica-item h4 { font-family: 'Space Grotesk'; font-size: 1.8rem; color: #fff; }
        .metrica-item small { color: var(--cor-ouro); font-size: 0.7rem; font-weight: 700; }

        /* STATUS FINANCEIRO */
        .card-financeiro { background: var(--cor-fundo-card); border: 1px solid var(--borda); border-radius: 20px; padding: 20px; margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; }
        .status-pill { padding: 8px 16px; border-radius: 50px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; border: 1px solid transparent; }
        .pago { background: rgba(46, 204, 113, 0.1); color: var(--sucesso); border-color: var(--sucesso); }
        .atrasado { background: rgba(255, 77, 77, 0.1); color: var(--erro); border-color: var(--erro); }

        /* SE√á√ïES E CONQUISTAS */
        .secao-titulo { font-family: 'Space Grotesk'; font-size: 1.1rem; color: var(--cor-ouro); margin: 35px 0 15px; }
        
        .badge-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .badge-item { min-width: 110px; text-align: center; background: var(--cor-fundo-card); padding: 20px; border-radius: 20px; border: 1px solid var(--borda); }
        .badge-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .badge-label { font-size: 0.6rem; font-weight: 800; color: var(--cor-ouro); text-transform: uppercase; }

        /* FEEDBACK E EVENTOS */
        .card-feedback { background: rgba(245, 197, 66, 0.02); border: 1px dashed var(--cor-ouro); padding: 25px; border-radius: 22px; font-style: italic; line-height: 1.6; color: #eee; font-size: 0.9rem; }
        
        .event-card { background: var(--cor-fundo-card); border: 1px solid var(--borda); padding: 15px; border-radius: 18px; display: flex; align-items: center; gap: 15px; }
        .event-date { background: var(--cor-ouro); color: #000; padding: 10px; border-radius: 12px; text-align: center; min-width: 60px; font-weight: 800; }

        /* HIST√ìRICO */
        .lista-historico { background: var(--cor-fundo-card); border: 1px solid var(--borda); border-radius: 20px; overflow: hidden; }
        .historico-item { padding: 15px 20px; border-bottom: 1px solid var(--borda); display: flex; justify-content: space-between; align-items: center; }
        .tag-presenca { background: rgba(52, 152, 219, 0.1); color: var(--azul); font-size: 0.6rem; font-weight: 800; padding: 4px 10px; border-radius: 6px; }

        /* BOT√ÉO CHECK-IN */
        .btn-checkin { background: var(--cor-ouro); color: #000; border: none; width: 100%; padding: 22px; border-radius: 20px; font-weight: 800; font-family: 'Space Grotesk'; cursor: pointer; font-size: 1rem; text-transform: uppercase; letter-spacing: 1.5px; transition: 0.3s; margin-top: 30px; box-shadow: 0 10px 30px rgba(245, 197, 66, 0.2); }
        .btn-checkin:hover { transform: translateY(-3px); }

    </style>
</head>
<body>

    <div class="top-bar">
        <a href="painel.html" class="btn-voltar">‚Üê VOLTAR AO PAINEL</a>
        <span style="font-size: 0.7rem; font-weight: 800; letter-spacing: 1px;">SISTEMA WIGGERS</span>
    </div>

    <div class="container">
        
        <div class="card-perfil">
            <h2 id="nome-aluno" style="font-family: 'Space Grotesk';">Carregando dados...</h2>
            <p id="txt-faixa" style="color: var(--cor-texto-cinza); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px;">IDENTIFICANDO GRADUA√á√ÉO</p>
            
            <div id="faixa-elemento" class="faixa-visual">
                <div class="ponteira-preta" id="container-graus">
                    </div>
            </div>
            
            <p style="font-size: 0.7rem; color: var(--cor-texto-cinza);">√öltima gradua√ß√£o registrada: <b id="data-graduacao">--/--/----</b></p>
        </div>

        <div class="card-financeiro">
            <div>
                <p style="font-size: 0.65rem; color: var(--cor-texto-cinza); font-weight: 800; text-transform: uppercase; margin-bottom: 5px;">Status de Assinatura</p>
                <p style="font-size: 0.9rem; font-weight: 600;">Vencimento: <span id="vencimento-aluno" style="color: #fff;">--/--/----</span></p>
            </div>
            <div id="status-pagamento" class="status-pill">VERIFICANDO...</div>
        </div>

        <div class="grid-metricas">
            <div class="metrica-item">
                <span>Total de Aulas</span>
                <h4 id="num-aulas">0</h4>
                <small>Hist√≥rico Geral</small>
            </div>
            <div class="metrica-item">
                <span>Frequ√™ncia M√™s</span>
                <h4 id="aulas-mes">0</h4>
                <small id="meta-mes">Meta: 16 aulas</small>
            </div>
        </div>

        <div class="metrica-item" style="margin-bottom: 25px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span id="label-progresso">Progresso T√©cnico</span>
                <span id="percentual-texto" style="color: var(--cor-ouro);">0%</span>
            </div>
            <div style="width: 100%; height: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; border: 1px solid var(--borda);">
                <div id="barra-progresso" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--cor-ouro), #fff); transition: 1s;"></div>
            </div>
        </div>

        <div class="secao-titulo">An√°lise do Professor</div>
        <div class="card-feedback" id="feedback-professor">
            Nenhum feedback registrado para o seu perfil no momento. Continue focado nos treinos b√°sicos!
        </div>

        <div class="secao-titulo">Minhas Conquistas</div>
        <div class="badge-scroll" id="container-badges">
            <div class="badge-item"><span class="badge-icon">üî•</span><span class="badge-label">7 DIAS</span></div>
            <div class="badge-item"><span class="badge-icon">ü•ã</span><span class="badge-label">ATIVO</span></div>
            <div class="badge-item" style="opacity: 0.3;"><span class="badge-icon">ü•á</span><span class="badge-label">CAMPE√ÉO</span></div>
        </div>

        <div class="secao-titulo">Pr√≥ximos Eventos</div>
        <div class="event-card">
            <div class="event-date">
                <span id="evento-mes" style="display: block; font-size: 0.7rem; text-transform: uppercase;">JAN</span>
                <span id="evento-dia" style="display: block; font-size: 1.2rem;">25</span>
            </div>
            <div>
                <h5 id="evento-titulo" style="font-size: 0.9rem; color: #fff;">Semin√°rio de Ver√£o</h5>
                <p id="evento-local" style="font-size: 0.7rem; color: var(--cor-texto-cinza);">Wiggers Academy ‚Ä¢ 09:00</p>
            </div>
        </div>

        <div class="secao-titulo">Hist√≥rico de Presen√ßas</div>
        <div class="lista-historico" id="lista-presencas">
            <div style="padding: 20px; text-align: center; color: var(--cor-texto-cinza); font-size: 0.8rem;">Carregando hist√≥rico...</div>
        </div>

        <button class="btn-checkin" onclick="realizarCheckin()">
            BATER PONTO (CHECK-IN)
        </button>
        <p style="text-align: center; font-size: 0.6rem; color: var(--cor-texto-cinza); margin-top: 15px; text-transform: uppercase; letter-spacing: 1px;">
            Sua localiza√ß√£o ser√° validada via GPS para confirmar a presen√ßa.
        </p>

    </div>

    <script type="module">
        import { auth, db } from "./firebase-config.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userId = user.uid;
                const alunoRef = ref(db, 'alunos/' + userId);

                onValue(alunoRef, (snapshot) => {
                    const d = snapshot.val();
                    if (d) {
                        // Nome e Faixa
                        document.getElementById('nome-aluno').innerText = d.nome || "Aluno";
                        document.getElementById('txt-faixa').innerText = d.faixa || "Branca";
                        document.getElementById('faixa-elemento').style.backgroundColor = d.corFaixaHex || "#FFFFFF";
                        
                        // Graus (Cria os risquinhos dinamicamente)
                        const containerGraus = document.getElementById('container-graus');
                        containerGraus.innerHTML = "";
                        for(let i=0; i < (d.graus || 0); i++) {
                            const g = document.createElement('div');
                            g.className = 'grau';
                            containerGraus.appendChild(g);
                        }

                        // M√©tricas e Progresso
                        document.getElementById('num-aulas').innerText = d.totalAulas || 0;
                        document.getElementById('aulas-mes').innerText = d.aulasMes || 0;
                        let perc = (d.totalAulas % 50) * 2; // Exemplo: meta de 50 aulas por grau
                        document.getElementById('barra-progresso').style.width = perc + "%";
                        document.getElementById('percentual-texto').innerText = perc + "%";

                        // Financeiro
                        const fin = document.getElementById('status-pagamento');
                        if(d.financeiro === "pago") {
                            fin.innerText = "PAGAMENTO EM DIA";
                            fin.className = "status-pill pago";
                        } else {
                            fin.innerText = "PEND√äNCIA FINANCEIRA";
                            fin.className = "status-pill atrasado";
                        }
                        document.getElementById('vencimento-aluno').innerText = d.vencimento || "--/--/----";

                        // Feedback
                        if(d.feedback) document.getElementById('feedback-professor').innerText = d.feedback;
                    }
                });
            } else {
                window.location.href = "login.html";
            }
        });

        window.realizarCheckin = function() {
            alert("Localizando Wiggers Academy... Check-in confirmado!");
            // Aqui voc√™ adicionaria a l√≥gica de GeoLocation e Update no Firebase
        };
    </script>

</body>
</html>
