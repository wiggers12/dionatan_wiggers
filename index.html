<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WiggersDev - Acesso à Plataforma</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDKs (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        body {
            margin: 0;
            background: #0a0a0a;
            color: #fff;
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    </style>
</head>
<body>

    <div class="w-full max-w-md p-4 sm:p-8 bg-[#111] rounded-xl shadow-2xl border border-green-500/30">
        <h1 class="text-3xl font-extrabold text-white text-center mb-2 flex items-center justify-center">
            <i data-lucide="lock" class="w-7 h-7 text-green-500 mr-3"></i> ACESSO EXCLUSIVO
        </h1>
        <p class="text-sm text-gray-400 text-center mb-6">Acesse com seu número. Teste grátis apenas para novos usuários.</p>

        <!-- Botões de pagamento -->
        <div class="flex flex-col sm:flex-row sm:space-x-3 mb-6">
            <a href="https://mpago.la/25vJUUE" target="_blank" class="block w-full sm:flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded-lg text-center transition duration-200 shadow-lg shadow-yellow-500/50 mb-3 sm:mb-0 text-sm">
                <i data-lucide="credit-card" class="w-4 h-4 mr-1 inline-block"></i> TORNAR-SE VIP (R$ 39,90)
            </a>

            <a href="https://www.mercadopago.com.br/checkout/v1/subscription/redirect/dc6948a0-3669-41da-8dbf-c6cee927e1d7/payment-option-form/?preference-id=2668676373-c8114912-e9f6-4213-90d7-81b074971f56"
               target="_blank" 
               class="block w-full sm:flex-1 bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 rounded-lg text-center transition duration-200 shadow-lg shadow-pink-600/50 text-sm">
                <i data-lucide="gauge" class="w-4 h-4 mr-1 inline-block"></i> PAINEL IA (R$ 99,90)
            </a>
        </div>

        <!-- Comparação -->
        <div class="mb-6 p-4 bg-[#1e1e1e] rounded-lg border border-gray-700">
            <p class="text-sm font-bold text-white mb-2 flex items-center">
                <i data-lucide="info" class="w-4 h-4 text-cyan-400 mr-2"></i> O que cada acesso libera:
            </p>
            <ul class="text-xs text-gray-300 space-y-1">
                <li class="flex"><span class="font-bold w-16 text-indigo-400">TESTE:</span> Plataforma de sinais (12h).</li>
                <li class="flex"><span class="font-bold w-16 text-yellow-400">VIP:</span> Acesso ilimitado.</li>
                <li class="flex"><span class="font-bold w-16 text-pink-400">IA:</span> Painel avançado + IA 24h.</li>
            </ul>
        </div>

        <div class="flex items-center my-6">
            <div class="flex-grow border-t border-gray-700"></div>
            <span class="flex-shrink mx-4 text-gray-500 text-sm">ENTRE COM SEU TELEFONE</span>
            <div class="flex-grow border-t border-gray-700"></div>
        </div>

        <!-- Form -->
        <form id="access-form" onsubmit="return false;"> 
            
            <div class="mb-4">
                <label for="name" class="block text-sm text-gray-400 mb-1">Seu Nome</label>
                <input type="text" id="name" required class="w-full p-3 rounded-lg bg-[#222] border border-gray-700 text-white">
            </div>

            <div class="mb-4">
                <label for="phone" class="block text-sm text-gray-400 mb-1">Telefone (DDI+DDD+Número)</label>
                <input type="tel" id="phone" required class="w-full p-3 rounded-lg bg-[#222] border border-gray-700 text-white">
            </div>

            <div id="status-message" class="mb-4 p-3 rounded-lg text-center font-medium hidden"></div>

            <div class="flex flex-col sm:flex-row sm:space-x-3">
                <button type="button" id="access-btn-test" onclick="handleStartTest(event)" class="w-full sm:flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition duration-200 mb-3 sm:mb-0 text-sm">
                    <i data-lucide="play" class="w-4 h-4 mr-2 inline-block"></i> INICIAR TESTE GRÁTIS
                </button>

                <button type="button" id="access-btn-vip" onclick="handleVipAccess(event)" class="w-full sm:flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition duration-200 text-sm">
                    <i data-lucide="log-in" class="w-4 h-4 mr-2 inline-block"></i> ENTRAR NA PLATAFORMA
                </button>
            </div>
        </form>
    </div>

    <!-- SCRIPT -->
    <script>
        const TARGET_PLATFORM_URL = "platforma_sinais.html"; 
        const TARGET_IA_PANEL_URL = "https://wiggers.dev.br/platforma_sinais.html";
        const MS_12H = 12 * 60 * 60 * 1000;

        const firebaseConfig = {
            apiKey: "AIzaSyBod8YVf5pKWI98m9rRR8axokDkNMlXX-k",
            authDomain: "aviatordaniel100x.firebaseapp.com",
            projectId: "aviatordaniel100x",
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const showStatus = (msg, error = false) => {
            const el = document.getElementById('status-message');
            el.textContent = msg;
            el.className = `mb-4 p-3 rounded-lg text-center font-medium ${error ? 'bg-red-900 text-red-300' : 'bg-green-900 text-green-300'}`;
            el.style.display = 'block';
        };

        const secureRedirect = (url, phone) => {
            setTimeout(() => {
                window.location.href = `${url}?userphone=${phone}`;
            }, 100);
        };

        const checkAccess = async (phone) => {
            const ref = db.collection('jogador').doc(phone);
            const doc = await ref.get();

            if (!doc.exists) {
                showStatus("Número não encontrado. Inicie o Teste Grátis.", true);
                return false;
            }

            const data = doc.data();
            const now = Date.now();

            if (data.ativo === false) {
                showStatus("Conta desativada pelo administrador.", true);
                return false;
            }

            // VIP
            if (data.status === 'VIP') {
                if (!data.data_expiracao || data.data_expiracao.toDate().getTime() > now) {
                    if (data.acesso_ia) secureRedirect(TARGET_IA_PANEL_URL, phone);
                    else secureRedirect(TARGET_PLATFORM_URL, phone);
                    return true;
                }

                showStatus("Seu VIP expirou. Renove para continuar.", true);
                return false;
            }

            // TESTE
            if (data.status === 'TESTE') {
                const start = data.data_inicio_teste.toDate().getTime();
                const expires = start + MS_12H;

                if (expires > now) {
                    secureRedirect(TARGET_PLATFORM_URL, phone);
                    return true;
                }

                await ref.update({ status: 'TESTE_EXPIRADO' });
                showStatus("Seu teste expirou. Torne-se VIP para continuar.", true);
                return false;
            }

            showStatus("Seu acesso expirou. Torne-se VIP.", true);
            return false;
        };

        const handleVipAccess = async (e) => {
            e.preventDefault();
            const phone = '55' + document.getElementById('phone').value.replace(/\D/g, '');

            if (phone.length < 12) return showStatus("Número inválido.", true);

            showStatus("Verificando acesso...", false);

            await auth.signInAnonymously();
            await checkAccess(phone);
        };

        const handleStartTest = async (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const phone = '55' + document.getElementById('phone').value.replace(/\D/g, '');

            if (name.length < 2 || phone.length < 12) {
                return showStatus("Preencha nome e número completos.", true);
            }

            await auth.signInAnonymously();
            const ref = db.collection('jogador').doc(phone);
            const doc = await ref.get();
            const now = new Date();

            if (doc.exists) {
                const data = doc.data();

                if (data.status === 'VIP' || data.status === 'TESTE_EXPIRADO') {
                    return showStatus("Você já usou seu teste ou é VIP. Clique em ENTRAR.", true);
                }

                if (data.status === 'TESTE') {
                    return checkAccess(phone);
                }
            }

            await ref.set({
                status: 'TESTE',
                nome: name,
                telefone: phone,
                data_inicio_teste: firebase.firestore.Timestamp.fromDate(now),
                data_expiracao: null,
                ativo: true,
                acesso_ia: false
            }, { merge: true });

            showStatus("Teste iniciado! Redirecionando...", false);
            secureRedirect(TARGET_PLATFORM_URL, phone);
        };
    </script>
</body>
</html>
