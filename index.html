<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>WiggersDev - Plataforma PRO</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React / ReactDOM / Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase v9 compat (somente leitura) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body {
            margin: 0;
            background: #0a0a0a;
            color: #fff;
            overflow-x: hidden;
            font-family: 'Poppins', sans-serif;
            -webkit-user-select: none;
            user-select: none;
        }

        iframe {
            width: 100%;
            border: none;
            height: calc(100vh - 140px);
        }

        /* Scroll invis√≠vel */
        *::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
/* ============================================================
   FUN√á√ïES DE UTILIDADE
   ============================================================ */
const getColorFromMultiplier = (v) => {
    const val = Number(v);
    if (val >= 10) return "text-pink-500";
    if (val >= 2) return "text-purple-400";
    if (val < 1.20) return "text-red-500";
    return "text-yellow-300";
};

/* ============================================================
   MODAL ‚Äî HIST√ìRICO
   ============================================================ */
const HistoryModal = ({ open, onClose, history }) => {
    if (!open) return null;

    return (
        <div className="fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4">
            <div className="bg-[#1E3224] w-full max-w-md p-5 rounded-xl shadow-xl max-h-[80vh] flex flex-col">
                
                <div className="flex justify-between items-center border-b border-gray-600 pb-3">
                    <h2 className="text-xl font-bold flex items-center">
                        <i data-lucide="clock" class="w-5 h-5 text-green-400 mr-2"></i>
                        Hist√≥rico de Multiplicadores
                    </h2>
                    <button onClick={onClose}>
                        <i data-lucide="x" class="w-6 h-6 text-white"></i>
                    </button>
                </div>

                <div className="overflow-y-auto mt-4 space-y-2 flex-1">
                    {history.map((item) => (
                        <div key={item.id} className="bg-[#263b2d] p-3 rounded-lg flex justify-between items-center">
                            <span className="text-sm text-gray-300">
                                {item.time}
                            </span>
                            <span className={`text-lg font-bold ${item.color}`}>
                                {item.multiplier}x
                            </span>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
};

/* ============================================================
   MODAL ‚Äî LIVE (CHAT FICT√çCIO)
   ============================================================ */
const LiveModal = ({ open, onClose }) => {
    if (!open) return null;

    const [messages, setMessages] = React.useState([
        { user: "Admin", text: "Bem-vindos √† Live! Pr√≥xima an√°lise em 2 minutos." },
        { user: "AnalistaPRO", text: "Fiquem atentos ao sinal üî•" },
        { user: "User123", text: "Bora lucrar üî•üî•" },
    ]);

    const [msg, setMsg] = React.useState("");

    const sendMessage = (e) => {
        e.preventDefault();
        if (!msg.trim()) return;
        setMessages((prev) => [...prev, { user: "Voc√™", text: msg }]);
        setMsg("");
    };

    return (
        <div className="fixed inset-0 bg-black/70 z-50 flex justify-center items-end md:items-center p-0 md:p-4">
            <div className="bg-[#1a1a1a] w-full max-w-lg h-[90vh] md:h-auto rounded-t-xl md:rounded-xl shadow-xl flex flex-col">
                
                <div className="bg-red-700 p-4 text-white font-bold flex justify-between items-center rounded-t-xl">
                    <div className="flex items-center">
                        <div className="w-3 h-3 bg-white rounded-full animate-ping mr-2"></div>
                        LIVE AO VIVO ‚Äî Sala PRO
                    </div>
                    <button onClick={onClose}>
                        <i data-lucide="x" class="w-6 h-6 text-white"></i>
                    </button>
                </div>

                <div className="h-40 bg-black flex items-center justify-center text-gray-500 italic border-b border-gray-800">
                    Transmiss√£o do Analista...
                </div>

                <div className="flex-1 overflow-y-auto p-3 space-y-2 text-sm">
                    {messages.map((m, i) => (
                        <div key={i}>
                            <span className="font-bold text-green-400">{m.user}: </span>
                            <span>{m.text}</span>
                        </div>
                    ))}
                </div>

                <form onSubmit={sendMessage} className="p-3 border-t border-gray-700">
                    <input
                        value={msg}
                        onChange={(e) => setMsg(e.target.value)}
                        className="w-full p-2 rounded-lg bg-[#262626] text-white border border-green-500 focus:ring-1 focus:ring-green-500"
                        placeholder="Digite sua mensagem..."
                    />
                </form>
            </div>
        </div>
    );
};

/* ============================================================
   MODAL ‚Äî SINAIS IA
   ============================================================ */
const SignalModal = ({ open, onClose, prediction }) => {
    if (!open) return null;

    let roxa = null;
    let rosa = null;

    if (prediction && prediction.signals.length > 0) {
        const sorted = [...prediction.signals].map(Number);

        roxa = sorted.filter(v => v >= 2 && v < 10).sort((a, b) => b - a)[0];
        rosa = sorted.filter(v => v >= 10).sort((a, b) => b - a)[0];
    }

    return (
        <div className="fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4">
            <div className="bg-[#1E3224] w-full max-w-md p-6 rounded-xl shadow-xl">

                <div className="flex justify-between items-center border-b border-gray-600 pb-3">
                    <h2 className="text-xl font-bold flex items-center">
                        <i data-lucide="trending-up" class="w-5 h-5 text-purple-400 mr-2"></i>
                        Pr√≥ximas Entradas IA
                    </h2>
                    <button onClick={onClose}>
                        <i data-lucide="x" class="w-6 h-6 text-white"></i>
                    </button>
                </div>

                <div className="space-y-4 mt-4">

                    {!roxa && !rosa && (
                        <p className="text-center text-gray-400 text-sm">Nenhuma entrada ativa.</p>
                    )}

                    {roxa && (
                        <div className="bg-[#263b2d] p-4 rounded-lg border-l-4 border-purple-400 flex justify-between items-center">
                            <span className="text-purple-400 font-bold">ENTRADA ROXA</span>
                            <span className="text-3xl font-extrabold text-purple-400">{roxa.toFixed(2)}x</span>
                        </div>
                    )}

                    {rosa && (
                        <div className="bg-[#263b2d] p-4 rounded-lg border-l-4 border-pink-500 flex justify-between items-center">
                            <span className="text-pink-500 font-bold">ENTRADA ROSA</span>
                            <span className="text-3xl font-extrabold text-pink-500">{rosa.toFixed(2)}x</span>
                        </div>
                    )}

                </div>

                <p className="text-xs text-gray-500 mt-4 border-t border-gray-600 pt-2">
                    O rob√¥ monitora 3 velas ap√≥s o sinal.  
                    Green confirmado se qualquer uma delas bater o alvo.
                </p>
            </div>
        </div>
    );
};

/* ============================================================
   MODAL ‚Äî REGRAS
   ============================================================ */
const RulesModal = ({ open, onClose }) => {
    if (!open) return null;

    return (
        <div className="fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4">
            <div className="bg-[#1a1a1a] w-full max-w-md p-6 rounded-xl shadow-xl">

                <div className="flex justify-between items-center border-b border-gray-700 pb-3">
                    <h2 className="text-xl font-bold flex items-center">
                        <i data-lucide="zap" class="w-5 h-5 text-yellow-500 mr-2"></i>
                        Regras da Estrat√©gia
                    </h2>
                    <button onClick={onClose}>
                        <i data-lucide="x" class="w-6 h-6 text-white"></i>
                    </button>
                </div>

                <div className="space-y-4 mt-4 text-gray-300 text-sm">

                    <div className="bg-[#262626] p-3 rounded-lg">
                        <p className="font-bold text-green-400 mb-1">üéØ Objetivo:</p>
                        Buscar no m√≠nimo **2.0x** ap√≥s o sinal da IA.
                    </div>

                    <div className="bg-[#262626] p-3 rounded-lg">
                        <p className="font-bold text-yellow-400 mb-1">‚ö†Ô∏è Gest√£o de Risco:</p>
                        <ul className="list-disc list-inside space-y-1 ml-2">
                            <li>Ap√≥s bater 2.0x, decis√£o √© sua.</li>
                            <li>M√°ximo 4 tentativas por sinal.</li>
                        </ul>
                    </div>

                    <div className="bg-[#262626] p-3 rounded-lg">
                        <p className="font-bold text-red-500 mb-1">üõë STOP:</p>
                        Se 3 velas forem abaixo de 2.0x ‚Üí RED.
                    </div>

                </div>
            </div>
        </div>
    );
};
/* ============================================================
   NAVIGATION BAR (Topo)
   ============================================================ */
const NavigationBar = ({ nextSignal, onHistory }) => {
    const value = nextSignal ? Number(nextSignal.valor) : null;

    return (
        <div className="bg-[#111] text-white p-3 flex justify-between items-center shadow-xl z-10">
            
            {/* MENU */}
            <div className="flex space-x-6 text-sm font-medium">
                <span className="text-green-400 font-bold">üéÆ JOGO</span>
                <span 
                    className="text-gray-400 hover:text-white cursor-pointer transition"
                    onClick={onHistory}
                >
                    üìú HIST√ìRICO
                </span>
                <span className="text-gray-400">üë§ PERFIL</span>
            </div>

            {/* √öLTIMO SINAL */}
            <div className="flex items-center bg-[#2a3b2f] p-2 rounded-full border border-green-500/40">
                <i data-lucide="zap" class="w-4 h-4 text-green-400 mr-1"></i>
                <span className="text-xs text-gray-400">√öltimo:</span>

                <span className={`ml-2 font-bold ${
                    value ? getColorFromMultiplier(value) : "text-gray-500"
                }`}>
                    {value ? `${value.toFixed(2)}x` : "--"}
                </span>
            </div>
        </div>
    );
};

/* ============================================================
   FOOTER FLUTUANTE
   ============================================================ */
const FooterBar = ({
    greens,
    reds,
    total,
    prediction,
    predicting,
    openSignal,
    openLive,
    openRules
}) => {
    const percent = total > 0 ? ((greens / total) * 100).toFixed(1) : "0.0";

    const mainValue = prediction?.signals?.[0]
        ? Number(prediction.signals[0])
        : null;

    return (
        <div className="fixed bottom-0 left-0 right-0 p-4 flex justify-center z-20">
            <div className="flex w-full max-w-lg space-x-2">

                {/* ASSERTIVIDADE */}
                <div className="flex-1 bg-[#111]/60 backdrop-blur-sm border border-gray-700/50 rounded-xl p-3 flex flex-col items-center">
                    <i data-lucide="check-circle" class="w-6 h-6 text-cyan-400"></i>
                    <span className="text-sm mt-1 font-bold">{percent}%</span>
                    <span className="text-[11px] text-gray-400">
                        {greens}G ‚Ä¢ {reds}R
                    </span>
                </div>

                {/* IA */}
                <button
                    onClick={openSignal}
                    className="flex-1 bg-[#111]/60 backdrop-blur-sm border border-gray-700/50 rounded-xl p-3 flex flex-col items-center hover:bg-white/10 transition"
                >
                    {predicting || !mainValue ? (
                        <i data-lucide="loader" class="w-6 h-6 text-purple-400 animate-spin"></i>
                    ) : (
                        <i data-lucide="trending-up" class="w-6 h-6 text-purple-400"></i>
                    )}

                    <span className={`text-sm font-bold mt-1 ${
                        predicting ? "text-gray-400" : getColorFromMultiplier(mainValue)
                    }`}>
                        {predicting ? "Analisando..." : `${mainValue.toFixed(2)}x`}
                    </span>

                    <span className="text-[10px] text-gray-400">Previs√£o IA</span>
                </button>

                {/* REGRAS */}
                <button
                    onClick={openRules}
                    className="flex-1 bg-[#111]/60 backdrop-blur-sm border border-gray-700/50 rounded-xl p-3 flex flex-col items-center hover:bg-white/10 transition"
                >
                    <i data-lucide="zap" class="w-6 h-6 text-yellow-500"></i>
                    <span className="text-sm font-bold mt-1">Regras</span>
                    <span className="text-[10px] text-gray-400">Estrat√©gia</span>
                </button>

                {/* LIVE */}
                <button
                    onClick={openLive}
                    className="flex-1 bg-[#111]/60 backdrop-blur-sm border border-gray-700/50 rounded-xl p-3 flex flex-col items-center hover:bg-white/10 transition"
                >
                    <i data-lucide="heart" class="w-6 h-6 text-red-500" fill="red"></i>
                    <span className="text-sm font-bold mt-1">Live</span>
                    <span className="text-[10px] text-gray-400">Analista</span>
                </button>
            </div>
        </div>
    );
};

/* ============================================================
   COMPONENTE PRINCIPAL
   ============================================================ */
const App = () => {

    /* -------------------------------------------
       1 ‚Äî Config Firebase (somente leitura)
       ------------------------------------------- */
    const firebaseConfig = {
        apiKey: "AIzaSyBod8YVf5pKWI98m9rRR8axokDkNMlXX-k",
        authDomain: "aviatordaniel100x.firebaseapp.com",
        projectId: "aviatordaniel100x",
        storageBucket: "aviatordaniel100x.firebasestorage.app",
        messagingSenderId: "169015417803",
        appId: "1:169015417803:web:ce4aa4f9b77d5ddb07344e"
    };

    const [db, setDb] = React.useState(null);

    /* Initialize Firebase once */
    React.useEffect(() => {
        const app = firebase.initializeApp(firebaseConfig);
        const _db = firebase.firestore(app);
        setDb(_db);
    }, []);

    /* -------------------------------------------
       2 ‚Äî Estados
       ------------------------------------------- */
    const [history, setHistory] = React.useState([]);
    const [nextSignal, setNextSignal] = React.useState(null);
    const [greens, setGreens] = React.useState(0);
    const [reds, setReds] = React.useState(0);
    const [total, setTotal] = React.useState(0);
    const [prediction, setPrediction] = React.useState(null);
    const [predicting, setPredicting] = React.useState(true);

    /* Modais */
    const [openHistory, setOpenHistory] = React.useState(false);
    const [openLive, setOpenLive] = React.useState(false);
    const [openSignal, setOpenSignal] = React.useState(false);
    const [openRules, setOpenRules] = React.useState(false);

    /* -------------------------------------------
       3 ‚Äî Firestore Listeners
       ------------------------------------------- */
    React.useEffect(() => {
        if (!db) return;

        /* ----------- LISTENER: hist√≥rico_sinais ----------- */
        db.collection("historico_sinais")
            .orderBy("criado", "desc")
            .limit(40)
            .onSnapshot((snap) => {
                const arr = snap.docs.map((doc) => {
                    const d = doc.data();
                    return {
                        id: doc.id,
                        multiplier: Number(d.valor).toFixed(2),
                        color: getColorFromMultiplier(d.valor),
                        time: d.criado.toDate().toLocaleTimeString("pt-BR", {
                            hour: "2-digit",
                            minute: "2-digit",
                        })
                    };
                });
                setHistory(arr);
            });

        /* ----------- LISTENER: ultimo_sinal/dados ----------- */
        db.collection("ultimo_sinal")
            .doc("dados")
            .onSnapshot((doc) => {
                if (!doc.exists) return setNextSignal(null);
                const d = doc.data();
                setNextSignal({
                    valor: Number(d.valor),
                    cor: d.cor,
                    hora: d.hora
                });
            });

        /* ----------- LISTENER: assertividade/dado ----------- */
        db.collection("assertividade")
            .doc("dado")
            .onSnapshot((doc) => {
                if (!doc.exists) return;
                const d = doc.data();
                setGreens(d.greens || 0);
                setReds(d.reds || 0);
                setTotal(d.total || 0);
            });

        /* ----------- LISTENER: analises/sequencia_3_azuis/sinais ----------- */
        db.collection("analises")
            .doc("sequencia_3_azuis")
            .collection("sinais")
            .orderBy("criado", "desc")
            .limit(1)
            .onSnapshot((snap) => {
                if (snap.empty) {
                    setPrediction(null);
                    setPredicting(true);
                    return;
                }

                const d = snap.docs[0].data();

                if (d.status !== "ATIVO") {
                    setPrediction(null);
                    setPredicting(true);
                    return;
                }

                setPrediction({
                    status: d.status,
                    signals: d.valores
                });

                setPredicting(false);
            });

    }, [db]);
    /* -------------------------------------------
       4 ‚Äî Renderiza√ß√£o
       ------------------------------------------- */
    return (
        <div className="min-h-screen flex flex-col bg-[#0a0a0a]">

            {/* NAVBAR */}
            <NavigationBar
                nextSignal={nextSignal}
                onHistory={() => setOpenHistory(true)}
            />

            {/* √ÅREA PRINCIPAL ‚Äî JOGO */}
            <div className="flex-1 overflow-hidden">
                <iframe
                    src="https://rn72q.com/subscribeReward?pid=575973404"
                    allow="fullscreen"
                    title="Jogo Integrado"
                ></iframe>
            </div>

            {/* RODAP√â */}
            <FooterBar
                greens={greens}
                reds={reds}
                total={total}
                prediction={prediction}
                predicting={predicting}
                openSignal={() => setOpenSignal(true)}
                openLive={() => setOpenLive(true)}
                openRules={() => setOpenRules(true)}
            />

            {/* MODAIS */}
            <HistoryModal
                open={openHistory}
                onClose={() => setOpenHistory(false)}
                history={history}
            />

            <LiveModal
                open={openLive}
                onClose={() => setOpenLive(false)}
            />

            <SignalModal
                open={openSignal}
                onClose={() => setOpenSignal(false)}
                prediction={prediction}
            />

            <RulesModal
                open={openRules}
                onClose={() => setOpenRules(false)}
            />
        </div>
    );
};

/* ============================================================
   RENDER FINAL
   ============================================================ */
ReactDOM.createRoot(document.getElementById("root")).render(<App />);

/* Inicializa √≠cones Lucide */
setTimeout(() => {
    lucide.createIcons();
}, 300);

    </script>
</body>
</html>

